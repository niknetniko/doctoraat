\documentclass[tikz,crop]{standalone}

\include{../tikz-preamble}



\begin{document}

\begin{tikzpicture}[x=0.75cm,y=0.75cm,fill fraction/.style={path picture={
  \fill[#1]
  (path picture bounding box.west) rectangle
  (path picture bounding box.south east);
}},
  fill fraction/.default=gray!50]

  \node[hnode,ultra thick,label={[fieldset,above left=-0.54\block and 4.5\block]harness},minimum width=14\block,minimum height=6\block] at (6, 3) (harness) {};

  \node[inner-exec,densely dashed,anchor=center,fill=none,minimum width=5\block,minimum height=5\block,label={[fieldset,above left=-0.52\block and -0.4\block]test script}] at (1.75,2.75) (testsc) {};

  \node[stmt,opacity=0.3] at (testsc|-0,4.375) (testsc1) {statement\textbar{}expression};
  \node[stmt,opacity=0.3] at (testsc|-0,3.5) (testsc2) {statement\textbar{}expression};
  \node[stmt,opacity=0.3] at (testsc|-0,2.625) (testsc3) {statement\textbar{}expression};
  \node[stmt] at (testsc|-0,1.75) (testsc4) {statement\textbar{}expression};
  \node[stmt,opacity=0.3] at (testsc|-0,0.875) (testsc5) {statement\textbar{}expression};

  \node[inner-exec,densely dashed,minimum width=8\block,minimum height=2\block,label={[fieldset,above left=-0.52\block and 0.8\block]submission}] at (8.75,4.25) (subm) {};

  \node[inner-exec, anchor=center,left=1\block of subm.center,fill=none,minimum width=2\block] (interface) {interfaces};

  \node[hnode,minimum width=2\block,bluebox] at (interface|-testsc4) (out) {exception\\value};
  \draw[arrow] (testsc4) -- (out);

  \draw[arrow,densely dotted] (out-|4.5,0) |- (interface);

  \draw[arrow,densely dotted] (interface) |- (out|-0,2.75) -| (out-|4.75,0);

  \node[inner-exec] at (11.125,2.25) (mor) {built-in oracle};
  \node[inner-exec] at (11.125,1.25) (cor) {custom oracle};

  \draw[arrow] (out) -| (mor.west-|9.125,0) -- (mor);
  \draw[arrow] (out) -| (cor.west-|9.125,0) -- (cor);


%  \node[hnode,minimum width=2\block,greenbox] at (0, 0) (stdin) {stdin};
%
%  \node[executable,label={[label distance=-0.44cm,anchor=south,fill fraction=gray!30,fill=white,text depth=.5ex]127:submission},minimum width=4\block,minimum height=1.5\block] at (3.75, 0) (subm) {};
%  \draw[arrow] (stdin) -- (subm);
%  \node[inner-exec, anchor=center,below=0mm of subm.center, anchor=center, fill=none] (main) {main};
%
%  \node[hnode,minimum width=2\block,bluebox] at (7.5, 0) (out) {stdout\\stderr};
%  \draw[arrow] (subm) -- (out);
%
%  \node[executable,minimum width=4\block,minimum height=1.5\block] at (11.5, 1) (builtin) {};
%  \node[executable,minimum width=4\block,minimum height=1.5\block] at (11.5, -1) (custom) {};
%
%  \node[inner-exec, anchor=center,below=0mm of builtin.center, anchor=center, fill=none] (mor) {built-in oracle};
%  \node[inner-exec, anchor=center,below=0mm of custom.center, anchor=center, fill=none] (cor) {custom oracle};
%
%  \draw[arrow] (out) -| (builtin.west-|9,0) -- (builtin);
%  \draw[arrow] (out) -| (custom.west-|9,0) -- (custom);

\end{tikzpicture}

\end{document}
