%! Package = scratch31
%! Author = niko
%! Date = 3/04/2024
%! An extension of the "scratch3" package with my custom stuff.

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{scratch31}[2024/04/03 Custom fork of scratch3 package]

% We need scratch3
\RequirePackage{scratch3}
\RequirePackage{xcolor}

% We need svg support in tikz.
\usetikzlibrary{svg.path}

% Custom colours
\definecolor{debuggerbool}{HTML}{0B8E69}
\definecolor{debuggerboold}{HTML}{0B8E69}
\definecolor{debuggerbooldd}{HTML}{0B8E69}
\definecolor{srcdebugger}{HTML}{0FBD8C}
\definecolor{srcdebuggerd}{HTML}{0DA57A}
\definecolor{srcdebuggerdd}{HTML}{0B8E69}

\definecolor{tubecolor}{HTML}{9ED9E6}

\definecolor{srcpoke}{HTML}{797270}
\definecolor{srcpoked}{HTML}{605B59}
\definecolor{srcpokedd}{HTML}{605B59}

\definecolor{srcpokeempty}{HTML}{605B59}
\definecolor{srcpokeemptyd}{HTML}{605B59}
\definecolor{srcpokeemptydd}{HTML}{605B59}


% Define some icons
\newcommand*\drawtesttube{%
    \kern0.2em\relax
    \begin{tikzpicture}[scale=0.4,baseline=3pt,rotate=100]
        \draw[fill=tubecolor,draw=none] svg {M35.043,22.196c0.813,0.616,1.77,0.915,2.717,0.915c1.358,0,2.703-0.615,3.589-1.783c1.501-1.98,1.111-4.803-0.868-6.305
        L21.868,0.915c-1.981-1.503-4.803-1.113-6.304,0.867s-1.113,4.804,0.868,6.305l0.254,0.192L2.776,26.633
        c-1.623,2.144-2.315,4.788-1.948,7.45c0.367,2.663,1.749,5.021,3.889,6.643l2.068,1.568c1.767,1.34,3.877,2.045,6.057,2.045
        c0.462,0,0.927-0.031,1.392-0.096c2.663-0.365,5.023-1.747,6.647-3.89L34.79,22.001L35.043,22.196z M13.709,34.918
        c-0.22,0.29-0.502,0.383-0.701,0.41c-0.201,0.026-0.496,0.014-0.785-0.205l-2.07-1.57c-0.289-0.218-0.381-0.5-0.409-0.697
        s-0.014-0.494,0.205-0.783l13.91-18.355l3.759,2.85L13.709,34.918z};
    \end{tikzpicture}%
    \kern0.2em\relax\space
}

\newcommand*\drawfeedbackcorrect{%
    \kern0.2em\relax
    \begin{tikzpicture}[scale=0.8,baseline=-14pt,yscale=-1]
        \draw[fill=white,draw=none,even odd rule] svg {M18.3121 23.3511C17.4463 23.0228 16.7081 22.5979 16.1267 22.1995C14.8513 22.7159 13.4578 23 12 23C5.92488 23 1.00002 18.0751 1.00002 12C1.00002 5.92487 5.92488 1 12 1C18.0751 1 23 5.92487 23 12C23 14.2788 22.306 16.3983 21.1179 18.1551C21.0425 19.6077 21.8054 20.9202 22.5972 22.0816C23.2907 23.0987 23.1167 23.9184 21.8236 23.9917C21.244 24.0245 19.9904 23.9874 18.3121 23.3511ZM3.00002 12C3.00002 7.02944 7.02945 3 12 3C16.9706 3 21 7.02944 21 12C21 13.9503 20.3808 15.7531 19.3281 17.2262C18.8622 17.8782 19.1018 19.0998 19.2616 19.8011C19.4167 20.4818 19.7533 21.2051 20.0856 21.8123C19.7674 21.7356 19.4111 21.6288 19.0212 21.481C18.1239 21.1407 17.3824 20.6624 16.8594 20.261C16.5626 20.0332 16.1635 19.9902 15.825 20.1494C14.6654 20.6947 13.3697 21 12 21C7.02945 21 3.00002 16.9706 3.00002 12ZM16.8 8.6C17.1314 8.15817 17.0418 7.53137 16.6 7.2C16.1582 6.86863 15.5314 6.95817 15.2 7.4L9.89182 14.4776L7.70712 12.2929C7.3166 11.9024 6.68343 11.9024 6.29291 12.2929C5.90238 12.6834 5.90238 13.3166 6.29291 13.7071L9.29291 16.7071C9.49789 16.9121 9.78174 17.018 10.0709 16.9975C10.3601 16.9769 10.6261 16.8319 10.8 16.6L16.8 8.6Z};
    \end{tikzpicture}%
    \kern0.2em\relax\space
}

\newcommand*\drawfeedbackwrong{%
    \kern0.2em\relax
    \begin{tikzpicture}[scale=0.8,baseline=-14pt,yscale=-1]
        \draw[fill=white,draw=none,even odd rule] svg {M18.3121 23.3511C17.4463 23.0228 16.7081 22.5979 16.1266 22.1995C14.8513 22.7159 13.4578 23 12 23C5.92487 23 1 18.0751 1 12C1 5.92487 5.92487 1 12 1C18.0751 1 23 5.92487 23 12C23 14.2788 22.306 16.3983 21.1179 18.1551C21.0425 19.6077 21.8054 20.9202 22.5972 22.0816C23.2907 23.0987 23.1167 23.9184 21.8236 23.9917C21.244 24.0245 19.9903 23.9874 18.3121 23.3511ZM3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12C21 13.9503 20.3808 15.7531 19.328 17.2262C18.8622 17.8782 19.1018 19.0998 19.2616 19.8011C19.4167 20.4818 19.7532 21.2051 20.0856 21.8123C19.7674 21.7356 19.4111 21.6288 19.0212 21.481C18.1239 21.1407 17.3824 20.6624 16.8594 20.261C16.5626 20.0332 16.1635 19.9902 15.825 20.1494C14.6654 20.6947 13.3697 21 12 21C7.02944 21 3 16.9706 3 12ZM9.1716 7.75736C8.78107 7.36684 8.14791 7.36684 7.75738 7.75736C7.36686 8.14788 7.36686 8.78105 7.75738 9.17157L10.5858 12L7.75738 14.8284C7.36686 15.219 7.36686 15.8521 7.75738 16.2426C8.14791 16.6332 8.78107 16.6332 9.1716 16.2426L12 13.4142L14.8285 16.2426C15.219 16.6332 15.8521 16.6332 16.2427 16.2426C16.6332 15.8521 16.6332 15.219 16.2427 14.8284L13.4142 12L16.2427 9.17157C16.6332 8.78105 16.6332 8.14788 16.2427 7.75736C15.8521 7.36684 15.219 7.36683 14.8285 7.75736L12 10.5858L9.1716 7.75736Z};
    \end{tikzpicture}%
    \kern0.2em\relax\space
}

\newcommand*\drawfeedback{%
    \kern0.2em\relax
    \begin{tikzpicture}[scale=0.6,baseline=-13pt,yscale=-1]
        \draw[fill=white,draw=none] svg {M4.393,4.788c-5.857,5.857-5.858,15.354,0,21.213c4.875,4.875,12.271,5.688,17.994,2.447l10.617,4.161l-4.857-9.998 c3.133-5.697,2.289-12.996-2.539-17.824C19.748-1.072,10.25-1.07,4.393,4.788z M25.317,22.149l0.261,0.512l1.092,2.142l0.006,0.01 l1.717,3.536l-3.748-1.47l-0.037-0.015l-2.352-0.883l-0.582-0.219c-4.773,3.076-11.221,2.526-15.394-1.646 C1.469,19.305,1.469,11.481,6.277,6.672c4.81-4.809,12.634-4.809,17.443,0.001C27.919,10.872,28.451,17.368,25.317,22.149z};
        \draw[fill=white,draw=none] svg {M24.228,13.042c0,0.714-0.578,1.292-1.292,1.292H6.52c-0.713,0-1.292-0.578-1.292-1.292v-0.416 c0-0.714,0.579-1.292,1.292-1.292h16.416c0.714,0,1.292,0.578,1.292,1.292V13.042z};
        \draw[fill=white,draw=none] svg {M18.228,18.042c0,0.714-0.396,1.292-0.884,1.292H6.112c-0.488,0-0.884-0.578-0.884-1.292v-0.416 c0-0.714,0.396-1.292,0.884-1.292h11.232c0.488,0,0.884,0.578,0.884,1.292V18.042z};
    \end{tikzpicture}%
    \kern0.2em\relax\space
}

\newcommand*\drawinteract{%
    \kern0.2em\relax
    \begin{tikzpicture}[scale=0.25,baseline=8pt]
        \path[draw=none,fill=white] (1.5264, 1.696)arc(-90.0:90.0:0.481)arc(90.0:270.0:0.481) -- cycle(1.5264, 1.4847).. controls (0.887, 1.4847) and (0.477, 1.1318) .. (0.477, 0.9599) -- (0.477, 0.6391) -- (2.5759, 0.6391) -- (2.5759, 0.9599).. controls (2.5759, 1.1677) and (2.1878, 1.4847) .. (1.5264, 1.4847) -- cycle;
    \end{tikzpicture}%
    \kern0.2em\relax\space
}

\newcommand*\drawobserve{%
    \kern0.2em\relax
    \begin{tikzpicture}[scale=0.9,baseline=-14pt,yscale=-1]
        \draw[draw=white,line join=round,line width=1.444pt] svg {M18.3944 7C18.9574 7 19.2389 7 19.4711 7.05628C20.199 7.2327 20.7673 7.801 20.9437 8.52887C21 8.76107 21 9.04256 21 9.60555L21 16C21 17.8856 21 18.8284 20.4142 19.4142C19.8284 20 18.8856 20 17 20L16 20L8 20L7 20C5.11438 20 4.17157 20 3.58579 19.4142C3 18.8284 3 17.8856 3 16L3 9.60555C3 9.04256 3 8.76107 3.05628 8.52887C3.23271 7.801 3.80101 7.2327 4.52887 7.05628C4.76107 7 5.04257 7 5.60555 7V7C5.92098 7 6.07869 7 6.2261 6.9779C6.68235 6.90952 7.10092 6.6855 7.4109 6.34382C7.51105 6.23342 7.59853 6.1022 7.7735 5.83975L8 5.5C8.39637 4.90544 8.59456 4.60816 8.86549 4.40367C9.03094 4.27879 9.2148 4.18039 9.41048 4.112C9.73092 4 10.0882 4 10.8028 4L13.1972 4C13.9118 4 14.2691 4 14.5895 4.112C14.7852 4.18039 14.9691 4.27879 15.1345 4.40367C15.4054 4.60816 15.6036 4.90544 16 5.5L16.2265 5.83975C16.4015 6.1022 16.4889 6.23342 16.5891 6.34382C16.8991 6.6855 17.3177 6.90952 17.7739 6.9779C17.9213 7 18.079 7 18.3944 7V7Z};
        \draw[draw=white,line join=round,line width=1.44pt] svg {M15 13C15 14.6569 13.6569 16 12 16C10.3431 16 9 14.6569 9 13C9 11.3431 10.3431 10 12 10C13.6569 10 15 11.3431 15 13Z};
        \node[fit=(current bounding box), inner ysep=4pt]{};
    \end{tikzpicture}%
    \kern0.2em\relax\space
}

\newcommand*\drawsquarearrow{%
    \kern0.2em\relax
    \begin{tikzpicture}[scale=0.9,baseline=7pt]
        \path[draw=white,line cap=round,line join=round,line width=0.0572cm,rounded corners=0.0882cm] (0.1764, 0.8819) rectangle (0.8819, 0.1764);
        \path[draw=white,line cap=round,line join=round,line width=0.0572cm] (0.3528, 0.5292) -- (0.7056, 0.5292)(0.7056, 0.5292) -- (0.5733, 0.3969)(0.7056, 0.5292) -- (0.5733, 0.6615);
    \end{tikzpicture}%
    \kern0.2em\relax\space
}

\colorlet{ctrl}{scrcontrol}
\colorlet{ctrld}{scrcontrold}
\colorlet{ctrldd}{scrcontroldd}


% Special commands that use the underscore...
%! parser = off
\catcode`\_11
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                dessine un bloc de répétition ou test                 %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\def\scr_blocklooppoke#1#2#3#4#5{% #1=texte  #2=instructions sup  #3=instructions inf #4=boucle infinie (1 ou 0)  #5=fleche de répétition (1 ou 0)
	\def\scr_current_blockcolor{srcpoke}
	\edef\scr_blocminheight{\dimexpr\scr_loopblockheight+\scr_ysepinf+\scr_ysepsup+\scr_corner\relax}% hauteur minimale d'un bloc normal
	\setbox\scr_box\hbox{%
		\pgfinterruptpicture
		\useKV[\scrname]{pre text}%
		\_inpicturetrue
		#1%
		\scr_blockstrut
		\endpgfinterruptpicture
	}%
	\scr_csedef{scr_txtloopwd\number\scr_loopnest}{\scr_maxdim(\wd\scr_box,\scr_minwd+\scr_corner*2+\scr_notch*2)}%
	\scr_csedef{scr_txtloopht\number\scr_loopnest}{\the\ht\scr_box}%
	\scr_csedef{scr_txtlooptotht\number\scr_loopnest}{\the\dimexpr\ht\scr_box+\dp\scr_box\relax}%
	\scr_csedef{toploopx\number\scr_loopnest}{\the\scr_xoffset}% coordonnées du point nord-west
	\scr_csedef{toploopy\number\scr_loopnest}{\the\scr_yoffset}%
	\scr_csedef{blocnum\number\scr_loopnest}{\number\scr_blocknum}%
	\advance\scr_xoffset\scr_loopblockwidth
	\advance\scr_yoffset\dimexpr-\scr_corner-\scr_ysepsup-\csname scr_txtlooptotht\number\scr_loopnest\endcsname-\scr_ysepinf\relax
	\ifboolKV[\scrname]{num blocks}
		{\scr_csdef{scr_numblockif\number\scr_loopnest}{%
			\node[
					at=(origin),
					draw=none,
					anchor=base east,
					xshift=-\scr_numsep,
					yshift=\csname toploopy\number\scr_loopnest\endcsname-\csname scr_txtloopht\number\scr_loopnest\endcsname-\scr_corner-\scr_ysepsup
				]
				(num)
				{\scr_eeearg\numblock{\csname blocnum\number\scr_loopnest\endcsname}};%
			}%
		}
		{\scr_cslet{scr_numblockif\number\scr_loopnest}\empty
		}%
	\advance\scr_loopnest1
	\advance\scr_blocknum1
	#2%
	\advance\scr_loopnest-1
	\scr_cslet{scr_blockstopif_\number\scr_loopnest}\scr_blockstop
	\scr_csedef{bottomifx\number\scr_loopnest}{\the\scr_xoffset}%
	\scr_csedef{bottomify\number\scr_loopnest}{\the\scr_yoffset}%
	\ifcat\relax\detokenize{#3}\relax\else% si instruction #3
		\advance\scr_yoffset\dimexpr-\scr_blocminheight\relax% épaisseur théorique de la branche "sinon"
		\scr_csedef{blocelsenum\number\scr_loopnest}{\number\scr_blocknum}%
		\ifboolKV[\scrname]{num blocks}
			{\scr_csdef{scr_numblockelse\number\scr_loopnest}{%
				\node[
						at=(origin),
						draw=none,
						anchor=base east,
						xshift=-\scr_numsep,
						yshift=\csname bottomify\number\scr_loopnest\endcsname-\scr_loopblockheight-\scr_corner
					]
					(num)
					{\scr_eeearg\numblock{\csname blocelsenum\number\scr_loopnest\endcsname}};}%
			}
			{\scr_cslet{scr_numblockelse\number\scr_loopnest}\empty
			}%
		\advance\scr_loopnest1
		\advance\scr_blocknum1
		#3%
		\advance\scr_loopnest-1
		\scr_csedef{bottomelsex\number\scr_loopnest}{\the\scr_xoffset}%
		\scr_csedef{bottomelsey\number\scr_loopnest}{\the\scr_yoffset}%
	\fi
	\advance\scr_yoffset by \dimexpr-\scr_blocminheight\relax% épaisseur de la branche du bas
	\def\scr_current_blockcolor{srcpoke}%
%	############## dessin du corps ##############
	\edef\scr_current_linecolor{\ifboolKV[\scrname]{print}{scr_linegray!\scr_contrast!black}{\scr_current_blockcolor dd}}%
	\draw[
			draw=\scr_current_linecolor,
			line width=\scr_linewidth,
			rounded corners=0.4*\scr_ex*\scr_scale,
			fill={%
				\ifboolKV[\scrname]{print}
					{\ifboolKV[\scrname]{fill blocks}
						{scr_fillgray}
						{none}%
					}
					{\scr_current_blockcolor}%
			}
		]
		(\csname toploopx\number\scr_loopnest\endcsname,\csname toploopy\number\scr_loopnest\endcsname)--++(0.66666*\scr_notch,0)--++(\scr_corner,-\scr_corner)--++(\scr_notch,0)--++(\scr_corner,\scr_corner)--++(\csname scr_txtloopwd\number\scr_loopnest\endcsname+2*\scr_xsep-\scr_corner*2-\scr_notch*1.66666,0)% ligne sup
		--++(0,-\csname scr_txtlooptotht\number\scr_loopnest\endcsname-\scr_ysepsup-\scr_ysepinf-\scr_corner)% ligne est "|"
		--++(-\csname scr_txtloopwd\number\scr_loopnest\endcsname-2*\scr_xsep+\scr_corner*2+\scr_notch*1.66666+\scr_loopblockwidth,0)--++(-\scr_corner,-\scr_corner)--++(-\scr_notch,0)--++(-\scr_corner,\scr_corner)--++(-\scr_notch*.66666,0)% ligne sud "--\__/---------"
		--(\csname bottomifx\number\scr_loopnest\endcsname,\csname bottomify\number\scr_loopnest\endcsname)% descente gauche bloc "if"
		\ifcat\relax\detokenize{#3}\relax\else% tracé de la branche du else
			\ifnum\csname scr_blockstopif_\number\scr_loopnest\endcsname=1
				--++(\csname scr_txtloopwd\number\scr_loopnest\endcsname+2*\scr_xsep-\scr_loopblockwidth,0)% ligne haut de la barre else "-----------------"
			\else
				--++(\scr_notch*0.66666,0)--++(\scr_corner,-\scr_corner)--++(\scr_notch,0)--++(\scr_corner,\scr_corner)--++(\csname scr_txtloopwd\number\scr_loopnest\endcsname+2*\scr_xsep-\scr_corner*2-\scr_notch*1.66666-\scr_loopblockwidth,0)% ligne haut de la barre else "--\__/---------"
			\fi
			--++(0,-\scr_loopblockheight-\scr_ysepsup-\scr_ysepinf-\scr_corner)% descente barre else
			--++(-\csname scr_txtloopwd\number\scr_loopnest\endcsname-2*\scr_xsep+\scr_corner*2+\scr_notch*1.66666+\scr_loopblockwidth,0)--++(-\scr_corner,-\scr_corner)--++(-\scr_notch,0)--++(-\scr_corner,\scr_corner)--++(-.66666*\scr_notch,0)% ligne sud "/--\__/---------"
			--(\csname bottomelsex\number\scr_loopnest\endcsname,\csname bottomelsey\number\scr_loopnest\endcsname)% descente gauche bloc "else"
		\fi
		\ifnum\scr_blockstop=1
			--++(\csname scr_txtloopwd\number\scr_loopnest\endcsname+2*\scr_xsep-\scr_loopblockwidth,0)% ligne haut de la barre de fin "----------------"
		\else
			--++(.66666*\scr_notch,0)--++(\scr_corner,-\scr_corner)--++(\scr_notch,0)--++(\scr_corner,\scr_corner)--++(\csname scr_txtloopwd\number\scr_loopnest\endcsname+2*\scr_xsep-\scr_corner*2-\scr_notch*1.66666-\scr_loopblockwidth,0)% ligne haut de la barre de fin "--\__/---------"
		\fi
		--++(0,-\scr_loopblockheight-\scr_ysepsup-\scr_ysepinf-\scr_corner)% ligne Est "\ + | + /"
		\ifnum#4=1 %infiniteloop
			--++(-\csname scr_txtloopwd\number\scr_loopnest\endcsname-2*\scr_xsep,0)% ligne Sud "\---------------"
		\else
			--++(-\csname scr_txtloopwd\number\scr_loopnest\endcsname-2*\scr_xsep+\scr_corner*2+\scr_notch*1.66666,0)--++(-\scr_corner,-\scr_corner)--++(-\scr_notch,0)--++(-\scr_corner,\scr_corner)--++(-.66666*\scr_notch,0)% ligne Sud "\--\__/---------"
		\fi
		--cycle;% remontée tout en haut et cycle ## bugfix 0.14
	\advance\scr_xoffset\dimexpr-\scr_loopblockwidth\relax
	\csname scr_numblockif\number\scr_loopnest\endcsname% numérote ou pas le texte dans le bandeau du haut
	\node[
			at=(origin),
			draw=none,
			anchor=base west,
			xshift=\csname toploopx\number\scr_loopnest\endcsname+\scr_xsep,
			yshift=\csname toploopy\number\scr_loopnest\endcsname-\csname scr_txtloopht\number\scr_loopnest\endcsname-\scr_corner-\scr_ysepsup,
			text={%
				\ifboolKV[\scrname]{print}
					{\useKV[\scrname]{text color}}
					{white}%
			}
		]
		(txt\csname blocnum\number\scr_loopnest\endcsname)
		{%
			\useKV[\scrname]{pre text}%
			\_inpicturetrue
			#1%
			\scr_blockstrut
		};
	\ifcat\relax\detokenize{#3}\relax\else
		\node[
				at=(origin),
				draw=none,
				anchor=base west,
				xshift=\csname toploopx\number\scr_loopnest\endcsname+\scr_xsep,
				yshift=\csname bottomify\number\scr_loopnest\endcsname-\scr_loopblockheight-\scr_corner,
				text={%
					\ifboolKV[\scrname]{print}
						{\useKV[\scrname]{text color}}
						{white}%
				}
			]
			(txt\csname blocelsenum\number\scr_loopnest\endcsname)
			{%
				\useKV[\scrname]{pre text}%
				\useKV[\scrname]{else word}%
			};
		\csname scr_numblockelse\number\scr_loopnest\endcsname% numérotation bloc else ou pas
	\fi
	\xdef\scr_blockstop{\ifnum#4=1 1\else0\fi}%
}
\newcommand*\blockdebug{\scr_normalblock{scrpen}}
\newcommand*\emptybooldebug[1][2em]{\_boolemptytrue\scr_boolbox{debuggerbool}{#1}}
\newcommand*\booldebug[1]{\scr_boolbox{srcdebugger}{#1}}
\newcommand*\blockpoke{\scr_normalblock{srcpoke}}
\newcommand*\drawicon[1]{%
    #1
    \kern.6em
    \begingroup
        \color{srcpokedd}
        \vrule width0.5pt
    \endgroup
    \kern.6em
}
\newcommand*\blockpokehat{\scr_initblock{srcpoke}}
\newcommand*\blockpokegroup[2]{\scr_blocklooppoke{#1}{#2}{}00}
\newcommand*\blockpokedgroup[3]{\scr_blocklooppoke{#1}{#2}{#3}00}
\newcommand*\boolpoke[1]{\scr_boolbox{srcpoke}{#1}}
\newcommand*\boolpokeempty[1][2em]{\_boolemptytrue\scr_boolbox{srcpokeempty}{#1}}
\newcommand*\ovalpoke[1]{\scr_ovalbox{0}{srcpoke}{#1}}
\scr_restorecatcode
%! parser = on

\endinput
